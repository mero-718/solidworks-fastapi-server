<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Upload STL & Update Attributes</title>
  <style>
    body { font-family: Arial; background: #f5f5f5; padding: 40px; }
    form { background: #fff; padding: 20px; border-radius: 10px; width: 400px; }
    input, button { width: 100%; padding: 10px; margin-top: 10px; }
    button { background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #0056b3; }
    #result { margin-top: 20px; font-weight: bold; }
  </style>
</head>
<body>
  <h2>Upload STL File</h2>
  <form id="uploadForm">
    <label>Select SLDPRT File:</label>
    <input type="file" id="fileInput" name="file" accept="*" required>

    <button type="submit">Upload</button>
  </form>

  <div id="result"></div>

  <script>
    const form = document.getElementById('uploadForm');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const fileInput = document.getElementById('fileInput');
	  
	  if (!fileInput.files[0]) {
        alert("Both STL and JSON files are required.");
        return;
      }

      const formData = new FormData();
      formData.append("file", fileInput.files[0]);

      const resDiv = document.getElementById('result');
      resDiv.innerText = "Uploading...";

      try {
		  const response = await fetch("http://localhost:8000/api/model", {
			method: "POST",
			body: formData
		  });

		  let resultText = await response.text(); // read as text first
		  let result;

		  try {
			result = JSON.parse(resultText); // try to parse JSON
		  } catch (parseErr) {
			result = { raw: resultText }; // fallback for HTML or plain text
		  }

		  if (response.ok) {
			resDiv.innerText = "✅ Success:\n" + JSON.stringify(result, null, 2);
		  } else {
			resDiv.innerText = "❌ Server Error (" + response.status + "):\n" + JSON.stringify(result, null, 2);
		  }

		} catch (err) {
		  resDiv.innerText = "❌ Network or Fetch Error:\n" + err;
		}
    });
  </script>
</body>
</html>
